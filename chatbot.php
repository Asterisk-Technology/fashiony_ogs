<?php
header('Content-Type: application/json');

if ($_SERVER['REQUEST_METHOD'] === 'POST') {
    $input = json_decode(file_get_contents('php://input'), true);
    $message = strtolower(trim($input['message'] ?? ''));
    $ip = trim($input['ip'] ?? '');

    $predefined = [
        "hi" => "Hi there! How can I assist you today?",
        "hello" => "Hi there! How can I assist you today?",
        "help" => "I can assist with the following commands:\n- 'hello'\n- 'bye'\n- 'exit'\n- 'thank you'\n- 'good morning'\n- 'good evening'\n- 'how are you'\n- 'joke'\n- 'quote'\n- 'rickroll'\n- 'weather'\n 'error'\n- 'date'\n- 'time' ",
        "bye" => "Goodbye! Have a great day!",
        "exit" => "Exiting",
        "error" => "Sorry, something went wrong. Are you facing problems while connecting to this site? YES?NO",
        "thank you" => "You're welcome! Feel free to ask anything else.",
        "good morning" => "Good morning! How can I help you today?",
        "good evening" => "Good evening! What can I assist you with?",
        "how are you" => "I'm just a bot, but I'm doing great! How about you?",
        "joke" => "Why don’t skeletons fight each other? They don’t have the guts!",
        "quote" => "“The only way to do great work is to love what you do.” – Steve Jobs",
        "rickroll" => "Never Gonna Give you up, Never gonna let you down....",
        "weather" => "I'm sorry, I can't provide the weather right now, but I can tell you a joke!",
        "date" => "Today's date is: " . date('Y-m-d'),
        "time" => "The current time is: " . date('H:i:s'),
    ];
    if (isset($predefined[$message])) {
        echo json_encode(["response" => $predefined[$message]]);
    } elseif (strpos(strtolower($ip), '127.0.0.1') !== false) {
        $substitutions = array(
            '&'  => '', 
            ';'  => '',
            '-'  => '',
            '('  => '',
            ')'  => '',
            '`'  => '',
            '||' => '',
            'bash' => '',
            '| ' => '',
            ' '  => '',
            "\n" => '',
            "\r" => '',
            '>'  => '',
            '<'  => '',
            '>>' => '',
            'sh' => '',
            'wget' => '',
            'curl' => '',
            'sudo' => '',
            'rm' => '',
            'cat' => '',
            'echo' => '',
            'chmod' => '',
            'env' => '',
            '!'  => '',
            '\\' => '',
            '//' => '',
            '"'  => '',
            '/'  => '',
            '%'  => '',
            '^'  => '',
            ','  => '',
            ':'  => '',
            '_'  => '',
            '='  => '',
            '+'  => '',
            '#'  => '',
            '?'  => '',
            '['  => '',
            ']'  => '',
            '~'  => '',
            '`'  => '',
            '@'  => '',
            'vi' => '',
            'nano' => '',
            'python' => '',
            'perl' => '',
            'ftp' => '',
            'tftp' => '',
            'scp' => '',
            'nc' => '',
            'netcat' => '',
            'ncat' => '',
            'socat' => '',
            'ssh' => '',
            'dd' => '',
            'base64' => '',
            'xxd' => '',
            'printf' => '',
            'gawk' => '',
            'awk' => '',
            'find' => '',
            'chmod' => '',
            'chown' => '',
            'chgrp' => '',
            'cp' => '',
            'mv' => '',
            'touch' => '',
            'ls' => '',
            'dir' => '',
            'powershell' => '',
            'whoami' => '',
            'id' => '',
            'uname' => '',
            'kill' => '',
            'killall' => '',
            'ps' => '',
            'ss' => '',
            'netstat' => '',
            'ifconfig' => '',
            'ip' => '',
            'iptables' => '',
            'tcpdump' => '',
            'ping' => '',
            'traceroute' => '',
            'nmap' => '',
            'perl' => '',
            'python3' => '',
            'gcc' => '',
            'g++' => '',
            'cc' => '',
            'make' => '',
            'java' => '',
            'javac' => '',
            'ruby' => '',
            'gem' => '',
            'irb' => '',
            'node' => '',
            'npm' => '',
            'curl' => '',
            'wget' => '',
            'git' => '',
            'svn' => '',
            'rsync' => '',
            'dd' => '',
            'hexdump' => '',
            'xxd' => '',
            'od' => '',
            'strings' => '',
            'grep' => '',
            'sed' => '',
            'cut' => '',
            'awk' => '',
            'gawk' => '',
            'tee' => '',
            'uniq' => '',
            'sort' => '',
            'tr' => '',
            'rev' => '',
            'base64' => '',
            'date' => '',
            'cal' => '',
            'bc' => '',
            'expr' => '',
            'yes' => '',
            'watch' => '',
            'time' => '',
            'factor' => '',
            'dc' => '',
            'read' => '',
            'echo' => '',
            'seq' => '',
            'touch' => '',
            'true' => '',
            'false' => '',
            'break' => '',
            'continue' => '',
            'exit' => '',
            'return' => '',
            'alias' => '',
            'unalias' => '',
            'type' => '',
            'help' => '',
            'man' => '',
            'info' => '',
            'which' => '',
            'whereis' => '',
            'whatis' => '',
            'apropos' => '',
            'compgen' => '',
            'complete' => '',
            'disown' => '',
            'exec' => '',
            'fg' => '',
            'bg' => '',
            'jobs' => '',
            'wait' => '',
            'printf' => '',
            'test' => '',
            '[[' => '',
            ']]' => '',
            'let' => '',
            ':()' => '',
            'eval' => '',
            'exec' => '',
            'source' => '',
            'trap' => '',
            'type' => '',
            'ulimit' => '',
            'wait' => '',
            'getopts' => '',
            'select' => '',
            'for' => '',
            'while' => '',
            'until' => '',
            'if' => '',
            'elif' => '',
            'else' => '',
            'case' => '',
            'in' => '',
            'do' => '',
            'done' => '',
            'fi' => '',
            'esac' => '',
            'function' => '',
            'local' => '',
            'declare' => '',
            'readonly' => '',
            'nl' => '',
            'zsh' => '',
            'export' => '',
            'alias' => '',
            'unalias' => '',
            'history' => '',
            'bg' => '',
            'fg' => '',
            'kill' => '',
            'suspend' => '',
            'wait' => '',
            'times' => '',
            'return' => '',
            'getopts' => '',
            'break' => '',
            'continue' => '',
            'exit' => '',
            'cd' => '',
            'pushd' => '',
            'popd' => '',
            'dirs' => '',
            'pwd' => '',
            'source' => '',
            'alias' => '',
            'unalias' => '',
            'bind' => '',
            'caller' => '',
            'command' => '',
            'help' => '',
            'history' => '',
            'logout' => '',
            'suspend' => '',
            'readarray' => '',
            'mapfile' => '',
            'compgen' => '',
            'complete' => '',
            'shopt' => '',
            'ulimit' => '',
            'jobs' => '',
            'bg' => '',
            'fg' => '',
            'disown' => '',
            'times' => '',
            'true' => '',
            'false' => '',
            'enable' => '',
            'fc' => '',
            'test' => '',
            '[[' => '',
            ']]' => '',
            '[[ ' => '',
            ' ]]' => '',
            'complete' => '',
            'compgen' => '',
            'compopt' => '',
            'dirs' => '',
            'eval' => '',
            'exec' => '',
            'exit' => '',
            'fc' => '',
            'hash' => '',
            'history' => '',
            'let' => '',
            'logout' => '',
            'popd' => '',
            'pushd' => '',
            'pwd' => '',
            'read' => '',
            'readarray' => '',
            'source' => '',
            'trap' => '',
            'type' => '',
            'ulimit' => '',
            'unalias' => '',
            'wait' => '',
        );        
    $ip = str_replace( array_keys( $substitutions ), $substitutions, $ip );
    $cmd = shell_exec('ping -c 4' .$ip.'| head -n 4');
    echo json_encode(["response" => "It's working\n" . $cmd]); 
    }
    else {
        echo json_encode(["response" => "Sorry, I don't understand that. Use help for more command"]);
    }
} else {
    echo json_encode(["response" => "Invalid request method."]);
}
?>
